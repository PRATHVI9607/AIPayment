# Docker Compose - All 8 Services in One Container

version: '3.8'

services:
  # Backend Services
  bank1-api:
    build:
      context: ./bank1
      dockerfile: Dockerfile
    ports:
      - "8001:8001"
    environment:
      - DATABASE_URL=${DATABASE_URL}
      - SECRET_KEY=${BANK1_SECRET_KEY}
    restart: unless-stopped
    healthcheck:
      disable: true

  bank2-api:
    build:
      context: ./bank2
      dockerfile: Dockerfile
    ports:
      - "8002:8002"
    environment:
      - DATABASE_URL=${DATABASE_URL}
      - SECRET_KEY=${BANK2_SECRET_KEY}
    restart: unless-stopped
    healthcheck:
      disable: true

  payment-gateway:
    build:
      context: ./payment-gateway
      dockerfile: Dockerfile
    ports:
      - "8000:8000"
    environment:
      - BANK1_URL=http://bank1-api:8001
      - BANK2_URL=http://bank2-api:8002
    depends_on:
      - bank1-api
      - bank2-api
    restart: unless-stopped
    healthcheck:
  shopping-api:
    build:
      context: ./shopping-app/backend
      dockerfile: Dockerfile
    ports:
      - "8003:8003"
    environment:
      - DATABASE_URL=${DATABASE_URL}
    restart: unless-stopped
    healthcheck:
      disable: true
      - DATABASE_URL=${DATABASE_URL}
    restart: unless-stopped

  # Frontend Services
  payment-ai-frontend:
    build:
      context: ./payment-ai-frontend
      dockerfile: Dockerfile
    ports:
      - "3000:3000"
    environment:
      - GROQ_API_KEY=${GROQ_API_KEY}
      - NEXT_PUBLIC_BANK1_API=http://localhost:8001
      - NEXT_PUBLIC_BANK2_API=http://localhost:8002
      - NEXT_PUBLIC_PAYMENT_GATEWAY_API=http://localhost:8000
      - NEXT_PUBLIC_SHOPPING_API=http://localhost:8003
    depends_on:
      - bank1-api
      - bank2-api
      - payment-gateway
      - shopping-api
    restart: unless-stopped

  bank1-frontend:
    build:
      context: ./bank1/frontend
      dockerfile: Dockerfile
    ports:
      - "3001:3001"
    environment:
      - NEXT_PUBLIC_BANK1_API=http://localhost:8001
    depends_on:
      - bank1-api
    restart: unless-stopped

  bank2-frontend:
    build:
      context: ./bank2/frontend
      dockerfile: Dockerfile
    ports:
      - "3002:3002"
    environment:
      - NEXT_PUBLIC_BANK2_API=http://localhost:8002
    depends_on:
      - bank2-api
    restart: unless-stopped

  shopping-frontend:
    build:
      context: ./shopping-app/frontend
      dockerfile: Dockerfile
    ports:
      - "3003:3003"
    environment:
      - NEXT_PUBLIC_SHOPPING_API=http://localhost:8003
    depends_on:
      - shopping-api
    restart: unless-stopped

networks:
  default:
    name: paymentai-network
